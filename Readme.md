# Ark Cluster

Running a multi instance ark cluster on your docker env.

Following maps are configured as one ark cluster:

- The Island
- Valguero
- Abberation
- Extinction
- Ragnarok
- Center
- Scorched

## Setup

docker-compose up -d

## Change Cluster

if you want to add a new map you must add the following block in docker-compose.yml file:

```yaml
services:
  island:
    image: r15ch13/arkcluster:latest
    env_file:
      - cluster.env
    environment:
      SERVERMAP: "TheIsland"
      SESSION_NAME: "Frost Cluster TheIsland"
      RCON_PORT: 32330
      GAME_PORT: 7777
      QUERY_PORT: 27015
    volumes:
      - server_island:/ark
      - cluster:/cluster
    ports:
      - "32330:32330/tcp"
      - "7777:7777/udp"
      - "7778:7778/udp"
      - "27015:27015/udp"
```

All environment variables are defined in cluster.env in this repository.
Keep in mind that you need to change the ports. Steam and Ark will search for these three ports.
Its starts with this port numbers so you can increase the number for the next block like this:

```yaml
      - "32331:32331/tcp"
      - "7779:7779/udp"
      - "7780:7780/udp" # special one keep in mind
      - "27016:27016/udp"
```

after that you must add a new volume to your service:

```yaml
volumes:
  server_island:
```

## Configure the Game

You can configure some game settings with env vars. You can find them in the cluster.env file to set it globally.
If you want to set different settings you can define them in the conf dir.

Remember that ark uses a Game.ini and GameUserSettings.ini to configure all settings in the game.
Additonaly arkmanager can set some configs to generate the GameUserSettings.ini.
You can configure the generation in the arkmanager.cfg file. Here you will find also the env vars defeined in cluster.env.

In the default config:

- Game.ini is everywhere the same on the cluster
- GameUserSettings generated by arkmanager and /ark/arkmanager.cfg. The default is located under /home/steam/arkmanager-user.cfg. Here are env vars so this will be sourced on loading
- I have more env vars in arkmanager-user.cfg and another docker-compose file as in the github repo where the image come from

## Backup

You can have a look in the backup folder to see all config files for different maps. You can use this as a backup folder of your settings.

## Auto restarts

If you want auto restarting the container to a given time (maybe 02:00) you can use the systemd service and timer in the folder systemd.

### Single instance

```sh
docker-compose -f docker-compose-single.yml -d
```

## arkmanager

[reop](https://github.com/arkmanager/ark-server-tools)
You can use the arkmanager to manage your cluster

```sh
arkmanager list-mods
arkmanager status
```

## Mods

must be set in server settings like S+ with the id: 731604991

## docker copy config

How to copy the config from the container to backup the settings?

```sh
docker run -d --rm --name dummy -v myvolume:/root alpine tail -f /dev/null
docker cp c:\myfolder\myfile.txt dummy:/root/myfile.txt
docker stop dummy
```

You can also copy the other way (from the volume to the local file system).

```sh
docker cp dummy:/root/myfile.txt c:\myfolder\myfile.txt
```
